# Прогнозирование оттока клиентов для оператора связи
Описание проекта: Оператор связи хочет научиться прогнозировать отток клиентов. Если выяснится, что пользователь планирует уйти, ему будут предложены промокоды и специальные условия. Команда оператора собрала персональные данные о некоторых клиентах, информацию об их тарифах и договорах.

Задачи проекта:
•	Провести предобработку и преобразовать данные, где необходимо
•	Провести первичный анализ данных для разработки стратегии
•	Создать сводную таблицу для дальнейшего обучения модели;
•	Провести повторную предобработку
•	Провести исследовательский анализ данных - визуализация данных, избавление от выбросов, выделение признаков важных для анализа;
•	Разбить данные на выборки;
•	Перебрать модели и подобрать их параметры;

Навыки и инструменты: исследовательский анализ, Python, Pandas, Scikit-learn, Matplotlib, машинное обучение, классификация и модели: Logistic regression, RandomForestClassifier, DecisionTreeClassifier, CatBoostClassifier, ExtraTreesClassifier, SGDClassifier, GradientBoostingClassifier, AdaBoostClassifier

Выводы: 

1 Выводы по предварительному анализу:
    Пропусков в данных нет ни в одной таблице
    Перевели дату начала контрактов в формат даты, сделали отдельные столбцы для года и месяца, чтобы посмотреть, сколько контрактов и когда были заключены. Больше всего было в 2014 и в 2018-2019 гг. Количество новых контрактов в феврале и в январе объясняются в том числе и особенностями таблицы, что данные собраны в феврале.
    Женщин и мужчин в данных почти поравну, как и тех, у кого есть партнер и нет
    Часть клиентов не пользовалось интернетом, либо по ним данных не было
    По части клиентов отсутствуют данные и по телефонии
    No в EndDate показывает, что пользователь продолжает пользоваться услугами - это целевой признак
    TotalCharges переведем при обработке данных в числовой тип, так как это некорректный тип данных для содержимого столбца
    SeniorCitizen данные числового типа, переведем в объектный
    Для корректного обучения модели к столбцам с категориальными данными PaymentMethod, Type, PaperlessBilling, gender, Partner, Dependents, SeniorCitizen, InternetService, OnlineSecurity, OnlineBackup, DeviceProtection, TechSupport, StreamingTV, StreamingMovies и MultipleLines применим при обработке One Hot Encoding

    Исследовательский анализ:

Как мы видим, отток у компании был в промежутке с 10.2019 по 1.2020 года. У тех, кто не рассторг контракт, меньше подключено услуг, так как число пропусков больше. Среди законченных контрактов, большее число клиентов платило в месяц бОльшие суммы. То есть явно одним из определяющих моментов для ухода стала большая месячная оплата. А среди оставшихся, большее число платило по минимальному тарифу.

влияние временных данных: Как видно из графиков, большая часть ушедших оформили свои контракты осенью, а больше всех в сентябре. Возможно, это контракты заведенные родителями для подростков, которые завершили, как только дети захотели оформить контракты сами. Большая часть контрактов, которые закрыли были оформлены в 2019 году, а большая часть тех, кто остались, оформили в 2014 то есть те, кто были дольше всего наиболее лояльны, кроме тех, кто были с 2013 года, возможно, поменяли тариф и изменили контракт. Проверить это нет возможности, так как недостаточно данных, нет данных по сменам тарифа.

социальные факторы: Распределение полов не влияет на завершение контракта. У тех, кто завершил контракты чаще нет партнера и нет иждивенцев. В отношении того, являлся ли пенсионером владелец контракта, то среди законченных контрактов число пенсионеров в процентном отношении выше, возможно, это связано со смертью владельца контракта, либо с переходом на другой контракт, который был бы удобнее для их родственников.

выбор услуг: Те, кто завершили контракт, чаще пользовались электронными чеками, платили раз в месяц и получали отчеты в электронном виде. Среди интернет услуг те, кто пользовались оптоволокном при интернет подключении и не использовали услуги онлайн безопасности, защиту девайсов, а также онлайн бэкапы. Большая часть завершивших контракт не использовали техническую поддержку, но пользовались стриминг телевидением, стримингом фильмов и наличием возможности ведения параллельных линий во время звонка. Так что вполне вероятно, они хотели уменьшить свою месячную оплату, так как у них было много дополнительных услуг.
    
влияние числовых факторов: Месячная оплата у тех, кто завершил контракты была в среднем выше, при этом они были не из старых клиентов по большей части, так как у многих из них число дней чаще от 500 и меньше, то есть старые клиенты более лояльны. Как следствие суммарные расходы у ушедших были, в основном, в диапазоне от 3000 до 0, с пиком в промежутке от 0 до 1000. Поскольку очень высокий уровень корреляции у общего числа дней и у суммарной суммы, поэтому один из этих столбцов стоит удалить из данных на обучение. Выгоднее по разбросу данных удалить 'TotalCharges'

Подготовка к обучению: Удалим столбцы с датами и другими временными данными, которые не понадобятся при обучении, а также столбец 'gender' и 'TotalCharges' Отношение ушедших клиентов к оставшимся в выборке примерно 3:1. Проведем эксперимент с upsampling и используем class_weight='balanced' при обучении некоторых моделей

Показатели по моделям: roc_auc константной модели: 0.5 Accuracy константной модели: 0.7381121362668559

Было обучено 8 моделей с использованием Паплайна и Гридсеча с подбором параметров, получились следующие результаты:

    LogisticRegresion -- roc_auc_train 0.844431, accuracy_train 0.804223
    RandomForestClassifier -- roc_auc_train 0.861120, accuracy_train 0.822860
    DecisionTreeClassifier -- roc_auc_train 0.815116, accuracy_train 0.765177
    CatBoostClassifier -- roc_auc_train 0.915219, accuracy_train 0.870073
    ExtraTreesClassifier -- roc_auc_train 0.839442 , accuracy_train 0.758074
    SGDClassifier -- roc_auc_train 0.796606, accuracy_train 0.773873
    GradientBoostingClassifier -- roc_auc_train 0.886620, accuracy_train 0.847531
    AdaBoostingClassifier -- roc_auc_train 0.871152, accuracy_train 0.826764

Таким образом, лучшие показатели у двух моделей с бустингом: CatBoostClassifier и GradientBoostingClassifier, у обеих на обучающей выборке roc_auc выше 88. Фаворит CatBoost, у нее на тестовой выборке: 0.923617625599333 (accuracy CatBoost на предсказании: 0.8800567778566359).

При проверке, что влияет на итоговое предсказание у модели CatBoost, были выявлены следующие показатели: число дней в компании в большей степени, размер месячной оплаты, выбор тарифа с оплатой в два года и использование интернета. А по разным другим факторам более лояльными к компании оказываются люди с партнером, с иждивенцами, оформившие контракт давно и подключившие не так много дополнительных услуг.
